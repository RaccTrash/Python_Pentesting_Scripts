import sys, socket

#import necessary modules
import getopt
import sys
#help
def usage():
	print("\033[1;31;29m --target, -t	-specifies target  \n")
	print ('')
	print ("--port, -p	-specifies max port number to scan")
try:
    opts, args = getopt.getopt(sys.argv[1:], 't:p:m:h', ['target=', 'port=', 'message=', 'help'])
except getopt.GetoptError:
    usage()
    sys.exit(2)

for opt, arg in opts:
    if opt in ('-h', '--help'):
        usage()
        sys.exit(2)
    elif opt in ('-t', '--target'):
	targethost = arg
    elif opt in ('-p', '--port'):
	targetport = int(arg)
    elif opt in ('-m', '--message'):
	messagem = str(arg)
    else:
        usage()
        sys.exit(2)


def srvr():
    import socket
    import threading
    bind_ip = str(targethost)
    bind_port = targetport
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server.bind((bind_ip, bind_port))
    server.listen(5)
    print"[*] Listening on %s:%d" % (bind_ip, bind_port)
    def handle_client(client_socket):
        request = client_socket.recv(1024)
        print"[*] Received: %s" % request
        client_socket.send(messagem)
        client_socket.close
       
    while True:
        client, addr = server.accept()
        print"[*] Accepted connection from: %s:%d" % (addr[0],addr[1])
        client_handler = threading.Thread(target=handle_client,args=(client,))
        client_handler.start()
srvr()
